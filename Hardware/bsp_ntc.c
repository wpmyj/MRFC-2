/*
***************************************************************************************************
*                                              APPLICATION CODE
*
*                          (c) Copyright 2015; Guangdong Hydrogen Energy Science And Technology Co.,Ltd
*
*               All rights reserved.  Protected by international copyright laws.
*               Knowledge of the source code may NOT be used without authorization.
***************************************************************************************************
*/
/*
***************************************************************************************************
* Filename      : bsp_ntc.c
* Version       : V2.00
* Programmer(s) : FanJun
***************************************************************************************************
*/
/*
***************************************************************************************************
*                                             INCLUDE FILES
***************************************************************************************************
*/
#include "bsp_ntc.h"
#include "stdio.h"
/*
***************************************************************************************************
*                                       LOCAL GLOBAL VARIABLES
***************************************************************************************************
*/
  





#if  PAREL_TEST     //适配攀业电堆NTC温度传感器

NTC_PARAMETER_TABLE_Typedef NTC_PARAMTET_TABLE[121] = {
	{ -20,	 963600 },
	{ -19,   900700 },
	{ -18,   845860 },
	{ -17,   797360 },
	{ -16,   753850 },
	{ -15,   714300 },
	{ -14,   677890 },
	{ -13,   643980 },
	{ -12,   612080 },
	{ -11,   581810 },
	{ -10,   552900 },
	{ -9,    525130 },
	{ -8,    498370 },
	{ -7,    472510 },
	{ -6,    447490 },
	{ -5,    423300 },
	{ -4,    400040 },
	{ -3,    378910 },
	{ -2,    359560 },
	{ -1,    341700 },
	{  0,    325100 },
	{  1,    309580 },
	{  2,    294990	},
	{  3,    281200 },
	{  4,    268130 },
	{  5,    255700 },
	{  6,    243840 },
	{  7,    232520 },
	{  8,    221680 },
	{  9,    211320 },
	{ 10,    201400 },
	{ 11,    191550 },
	{ 12,    182590 },
	{ 13,    174310 },
	{ 14,    166550 },
	{ 15,    159190 },
	{ 16,    152150 },
	{ 17,    145380 },
	{ 18,    138860 },
	{ 19,    132560 },
	{ 20,    126480 },
	{ 21,    120640 },
	{ 22,    115050 },
	{ 23,    109730 },
	{ 24,    104710	},
	{ 25,    100000 },
	{ 26,    95629 },
	{ 27,    91617 },
	{ 28,    87985 },
	{ 29,    84752 },
	{ 30,    81940 },
	{ 31,    78720 },
	{ 32,    75571 },
	{ 33,    72486 },
	{ 34,    69467 },
	{ 35,    66520 },
	{ 36,    63654 },
	{ 37,    60882 },
	{ 38,    58216 },
	{ 39,    55671 },
	{ 40,    53260 },
	{ 41,    50997 },
	{ 42,    48894 },
	{ 43,    46963 },
	{ 44,    45215 },
	{ 45,    43660 },
	{ 46,    41926	},
	{ 47,    40288 },
	{ 48,    38740 },
	{ 49,    37273 },
	{ 50,    35880 },
	{ 51,    34554 },
	{ 52,    33289 },
	{ 53,    32077 },
	{ 54,    30913 },
	{ 55,    29790 },
	{ 56,    28703 },
	{ 57,    27647 },
	{ 58,    26617 },
	{ 59,    25610 },
	{ 60,    24620 },
	{ 61,    23729 },
	{ 62,    22869 },
	{ 63,    22039 },
	{ 64,    21239 },
	{ 65,    20470 },
	{ 66,    19730 },
	{ 67,    19020 },
	{ 68,    18339 },
	{ 69,    17687 },
	{ 70,    17063 },
	{ 71,    16467 },
	{ 72,    15899 },
	{ 73,    15357 },
	{ 74,    14842 },
	{ 75,    14353 },
	{ 76,    13895 },
	{ 77,    13456 },
	{ 78,    13034 },
	{ 79,    12628 },
	{ 80,    12236 },
	{ 81,    11857 },
	{ 82,    11489 },
	{ 83,    11130 },
	{ 84,    10781 },
	{ 85,    10439 },
	{ 86,    10104 },
	{ 87,    9774 },
	{ 88,    9450 },
	{ 89,    9131 },
	{ 90,    8816 },
	{ 91,    8531 },
	{ 92,    8262 },
	{ 93,    8006 },
	{ 94,    7762 },
	{ 95,    7529 },
	{ 96,    7303 },
	{ 97,    7086 },
	{ 98,    6875 },
	{ 99,    6668 },
	{ 100,   6467 }
};

#endif

#if  BALLARD_TEST   //巴拉德电堆温度传感器
NTC_PARAMETER_TABLE_Typedef NTC_PARAMTET_TABLE[166] = {
    { -40,   4071370},
    { -39,   3799004},
    { -38,   3546481},
    { -37,   3312243},
    { -36,   3094866},
    { -35,   2893041},
    { -34,   2705570},
    { -33,   2531351},
    { -32,   2369375},
    { -31,   2218714},
    { -30,   2078515},
    { -29,   1947995},
    { -28,   1826432},
    { -27,   1713162},
    { -26,   1607574},
    { -25,   1509106},
    { -24,   1417239},
    { -23,   1331495},
    { -22,   1251431},
    { -21,   1176643},
    { -20,   1106752},
    { -19,   1041413},
    { -18,   980305},
    { -17,   923131},
    { -16,   869616},
    { -15,   819508},
    { -14,   772570},
    { -13,   728587},
    { -12,   687355},
    { -11,   648689},
    { -10,   612416},
    { -9,    578374},
    { -8,    546415},
    { -7,    516401},
    { -6,    488202},
    { -5,    461700},
    { -4,    436784},
    { -3,    413350},
    { -2,    391304},
    { -1,    370555},
    {0,     351020},
    {1,     332623},
    {2,     315290},
    {3,     298956},
    {4,     283557},
    {5,     269036},
    {6,     255337},
    {7,     242410},
    {8,     230207},
    {9,     218685},
    {10,    207801},
    {11,    197518},
    {12,    187800},
    {13,    178611},
    {14,    169921},
    {15,    161701},
    {16,    153922},
    {17,    146559},
    {18,    139587},
    {19,    132983},
    {20,    126727},
    {21,    120799},
    {22,    115179},
    {23,    109850},
    {24,    104795},
    {25,    100000},
    {26,    95449},
    {27,    91129},
    {28,    87027},
    {29,    83131},
    {30,    79430},
    {31,    75913},
    {32,    72569},
    {33,    69390},
    {34,    66367},
    {35,    63491},
    {36,    60754},
    {37,    58150},
    {38,    55670},
    {39,    53309},
    {40,    51060},
    {41,    48917},
    {42,    46875},
    {43,    44929},
    {44,    43073},
    {45,    41303},
    {46,    39615},
    {47,    38004},
    {48,    36467},
    {49,    35000},
    {50,    33599},
    {51,    32262},
    {52,    30984},
    {53,    29763},
    {54,    28596},
    {55,    27481},
    {56,    26415},
    {57,    25395},
    {58,    24420},
    {59,    23487},
    {60,    22594},
    {61,    21740},
    {62,    20922},
    {63,    20138},
    {64,    19388},
    {65,    18670},
    {66,    17981},
    {67,    17322},
    {68,    16689},
    {69,    16083},
    {70,    15502},
    {71,    14945},
    {72,    14410},
    {73,    13897},
    {74,    13405},
    {75,    12932},
    {76,    12478},
    {77,    12043},
    {78,    11625},
    {79,    11223},
    {80,    10837},
    {81,    10466},
    {82,    10109},
    {83,    9767},
    {84,    9437},
    {85,    9121},
    {86,    8816},
    {87,    8523},
    {88,    8241},
    {89,    7970},
    {90,    7708},
    {91,    7457},
    {92,    7215},
    {93,    6982},
    {94,    6758},
    {95,    6541},
    {96,    6333},
    {97,    6132},
    {98,    5939},
    {99,    5753},
    {100,   5573},
    {101,   5400},
    {102,   5232},
    {103,   5071},
    {104,   4916},
    {105,   4766},
    {106,   4621},
    {107,   4481},
    {108,   4346},
    {109,   4216},
    {110,   4090},
    {111,   3969},
    {112,   3852},
    {113,   3738},
    {114,   3629},
    {115,   3523},
    {116,   3421},
    {117,   3322},
    {118,   3227},
    {119,   3134},
    {120,   3045},
    {121,   2959},
    {122,   2875},
    {123,   2794},
    {124,   2716},
    {125,   2640}
};

#endif 

/*
***************************************************************************************************
*                                              GetSrcTemp()
*
* Description : get the source temperature.
*
* Argument(s) : none.
*
* Return(s)   : ntc temperature.
*
* Caller(s)   : Application.
***************************************************************************************************
*/
#if 0
int8_t GetSrcTemp(double Rt_Value)
{
    int i;
    uint32_t m_u32Rt_Value = (uint32_t)Rt_Value;

    if(m_u32Rt_Value < NTC_PARAMTET_TABLE[165].resistance) {
        return NTC_PARAMTET_TABLE[165].temp;
    } else if(m_u32Rt_Value > NTC_PARAMTET_TABLE[0].resistance) {
        return -40;
    } else {
        for(i = 164; i > 0;) {
            if(m_u32Rt_Value <= NTC_PARAMTET_TABLE[i].resistance) {
                break;
                //  return  NTC_PARAMTET_TABLE[i].temp;
            }

            i --;
        }
    }

    return  NTC_PARAMTET_TABLE[i].temp;
}

#endif

#if  BALLARD_TEST
uint8_t GetSourceTemp(double Rt_Value)
{
    int i;
    uint32_t m_u32Rt_Value = (uint32_t)Rt_Value;


    if(m_u32Rt_Value < NTC_PARAMTET_TABLE[125].resistance) {
        return 125;
    }

    if(m_u32Rt_Value > NTC_PARAMTET_TABLE[0].resistance) {
        return 0;
    }

    for(i = 125; i >= 0;) {
        if(m_u32Rt_Value <= NTC_PARAMTET_TABLE[i].resistance) {
            break;
        }

        i --;
    }

    return  NTC_PARAMTET_TABLE[i].temp;
}

#endif



#if  PAREL_TEST

int8_t GetSourceTemp(double Rt_Value)
{
    int i;
    uint32_t m_u32Rt_Value = (uint32_t)Rt_Value;

    if(m_u32Rt_Value < NTC_PARAMTET_TABLE[120].resistance) {
        return NTC_PARAMTET_TABLE[120].temp;
    } else if(m_u32Rt_Value > NTC_PARAMTET_TABLE[0].resistance) {
        return -20;
    } else {
        for(i = 119; i > 0;) {
            if(m_u32Rt_Value <= NTC_PARAMTET_TABLE[i].resistance) {
                break;
            }
            i --;
        }
    }
    return  NTC_PARAMTET_TABLE[i].temp;
}


#endif


